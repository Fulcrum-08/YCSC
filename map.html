<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Company Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:Arial,Helvetica,sans-serif;
    background:#f5f7f3;
    color:#2f3e2f;
    padding-top:90px;
}

/* NAVBAR */
nav{
    position:fixed;
    top:0;
    width:100%;
    background:#2f5d3a;
    padding:14px 40px;
    display:grid;
    grid-template-columns:1fr auto 1fr;
    align-items:center;
    z-index:1000;
}

.nav-left,.nav-center,.nav-right{
    display:flex;
    gap:22px;
    align-items:center;
}

nav a{
    color:#e8f2ea;
    text-decoration:none;
    font-size:16px;
}

.main-tab{
    background:#f1f5ef;
    color:#2f5d3a;
    padding:10px 24px;
    border-radius:999px;
    font-weight:bold;
}

/* SECTIONS */
section{
    padding:60px 20px;
    text-align:center;
    background:#eef4ee;
}

section h2{
    font-size:32px;
    margin-bottom:20px;
    color:#2f5d3a;
}

/* MAP */
.map-wrapper{
    position:relative;
}

#map{
    height:600px;
    width:100%;
}

/* MAP BANNER */
.map-banner{
    position:absolute;
    top:15px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(47,93,58,0.95);
    color:#f1f5ef;
    padding:14px 28px;
    border-radius:14px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    display:none;
    z-index:500;
    min-width:320px;
}

.map-banner h3{
    font-size:20px;
    margin-bottom:10px;
}

.map-banner .stats{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:10px;
    font-size:14px;
}

/* STATS GRID */
.stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:24px;
    margin-top:30px;
}

.stat-box{
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.stat-box canvas{
    max-width:120px;
    margin:auto;
}

/* ===== MINIMAL LAYER CONTROL ===== */
.leaflet-control-layers{
    background:transparent;
    box-shadow:none;
    border:none;
    padding:6px;
}

.leaflet-control-layers-expanded{
    background:transparent;
}

.leaflet-control-layers label{
    font-size:14px;
    color:#2f5d3a;
    display:flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
}

.leaflet-control-layers input{
    accent-color:#2f5d3a;
}
</style>
</head>

<body>

<nav>
    <div class="nav-left">
        <a href="index.html#home">Home</a>
    </div>

    <div class="nav-center">
        <a href="programs.html" class="main-tab">Programs</a>
        <a href="map.html" class="main-tab">Map</a>
        <a href="Shoping_Hacks.html" class="main-tab">Shop</a>
    </div>

    <div class="nav-right">
        <a href="index.html#about">About</a>
        <a href="index.html#contact">Contact</a>
    </div>
</nav>

<section>
<h2>Explore Our City Map</h2>
<p>Hover over a ward to view details and statistics.</p>
</section>

<div class="map-wrapper">
    <div id="map"></div>

    <div id="mapBanner" class="map-banner">
        <h3 id="wardName">Ward</h3>
        <div class="stats">
            <div><strong id="bPop">–</strong><br>Population</div>
            <div><strong id="bArea">–</strong><br>Area (km²)</div>
            <div><strong id="bProj">–</strong><br>Projects</div>
        </div>
    </div>
</div>

<section>
<h2>City Statistics</h2>
<div class="stats-grid">
    <div class="stat-box"><canvas id="pie0"></canvas></div>
    <div class="stat-box"><canvas id="pie1"></canvas></div>
    <div class="stat-box"><canvas id="pie2"></canvas></div>
    <div class="stat-box"><canvas id="pie3"></canvas></div>
    <div class="stat-box"><canvas id="pie4"></canvas></div>
</div>
</section>

<script>
/* MAP */
const map=L.map('map').setView([42.33,-72.68],13);
const overlays={};

const layerControl=L.control.layers(null,overlays,{collapsed:false}).addTo(map);

fetch("wards.geojson")
.then(r=>r.json())
.then(data=>{
    const wardLayer=L.geoJSON(data,{
        style:{color:"#2f5d3a",weight:2,fillOpacity:.3},
        onEachFeature:(f,l)=>{
            l.on({
                mouseover:()=>{
                    l.setStyle({weight:4,fillOpacity:.6});
                    l.bringToFront();

                    wardName.textContent = f.properties.name || "Ward";
                    bPop.textContent     = f.properties.population ?? "N/A";
                    bArea.textContent    = f.properties.area ?? "N/A";
                    bProj.textContent    = f.properties.projects ?? "N/A";

                    mapBanner.style.display="block";
                },
                mouseout:()=>{
                    wardLayer.resetStyle(l);
                    mapBanner.style.display="none";
                }
            });
        }
    }).addTo(map);

    map.fitBounds(wardLayer.getBounds());
});

function addOverlay(name,url,color){
    fetch(url)
    .then(r=>r.json())
    .then(d=>{
        overlays[name]=L.geoJSON(d,{style:{color,weight:2}});
        layerControl.addOverlay(overlays[name],name);
    });
}

addOverlay("Buildings","buildings.geojson","red");
addOverlay("River","CTriver.geojson","blue");
addOverlay("Roads","roads.geojson","orange");

/* CHARTS */
const centerText={
id:'centerText',
afterDraw(chart){
const v=chart.data.datasets[0].data[0];
const c=chart.ctx;
c.save();
c.font="bold 18px Arial";
c.fillStyle="#2f5d3a";
c.textAlign="center";
c.textBaseline="middle";
c.fillText(v+"%",chart.width/2,chart.height/2);
c.restore();
}
};

[[80,20],[75,25],[40,60],[66,34],[25,75]].forEach((d,i)=>{
new Chart(document.getElementById("pie"+i),{
type:"doughnut",
data:{datasets:[{data:d,backgroundColor:["#6a8f5e","#cfe3d4"]}]},
options:{cutout:"70%",plugins:{legend:{display:false}}},
plugins:[centerText]
});
});
</script>

</body>
</html>
